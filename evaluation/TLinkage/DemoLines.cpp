#include"Line2DTLinkage.h"
#include"UniformSampler.h"

//TODO: Use input from XML.  This is a very crude file and is meant for only testing purposes

//The data is taken from the demo.m file of the official TLinkage code.  It is has points of a star

int main() {
	Line2DTLinkage t;
	ArrayXXf data(2, 500), samples, hypotheses, residuals, pref;
	ArrayXf clusters;

	data << 0.55491,0.7383,-0.77711,0.65554,0.30539,0.80124,0.95896,0.7397,-0.62598,0.49142,-0.63084,0.42236,-0.26551,-0.75985,0.69429,0.04465,0.22829,-0.55936,0.11041,0.67956,0.28449,0.42624,-0.57174,-0.59901,0.86192,0.97659,0.95928,0.22944,0.51323,-0.66243,0.7276,0.78847,0.42901,-0.32646,0.34487,0.00087973,0.82796,-0.32224,-0.17294,-0.074389,0.49399,-0.018918,0.095072,0.18509,0.60525,-0.30097,-0.7607,-0.53225,-0.056945,-0.043001,-0.018694,-0.75488,0.072059,0.044645,0.18002,-0.3819,-0.60365,-0.82054,-0.14677,-0.22287,-0.02503,-0.80369,-0.41448,-0.031382,-0.80503,0.080156,-0.11666,-0.21142,-0.029138,-0.38393,0.050245,-0.17998,0.24461,0.27398,-0.36467,-0.1604,-0.65279,-0.029489,-0.023315,0.22183,-0.015005,-0.1019,-0.12867,-0.76081,0.064858,-0.58957,-0.42728,0.09662,0.10773,-0.18827,-0.31828,-0.14108,-0.26661,-0.7635,-0.051051,0.18639,-0.42394,-0.55016,-0.55328,-0.4018,0.31855,0.31728,0.31031,0.30162,0.3042,0.29955,0.29054,0.30732,0.32318,0.29935,0.29374,0.33183,0.32743,0.30913,0.31782,0.31622,0.30784,0.34366,0.30884,0.30986,0.3163,0.30487,0.33697,0.31057,0.31922,0.32387,0.31294,0.3049,0.28996,0.29846,0.3009,0.32511,0.30885,0.30528,0.30506,0.29358,0.29017,0.2949,0.2937,0.31162,0.32498,0.28625,0.31009,0.31651,0.3008,0.30882,0.34106,0.28787,0.3139,0.31832,-0.16348,0.091359,-0.74526,0.2478,-0.63837,-0.10731,-0.556,-0.41176,-0.57427,-0.54373,0.26214,0.21647,-0.50933,-0.59545,-0.1908,0.21876,-0.66107,-0.75368,-0.19736,-0.044825,-0.55941,-0.007772,-0.22272,-0.37272,0.20045,-0.58581,0.051384,-0.26791,-0.54238,-0.57848,-0.41696,0.093798,-0.58053,-0.48994,-0.66884,-0.35762,-0.15072,-0.66679,-0.66028,-0.20194,-0.20121,-0.028469,0.30909,-0.20819,-0.25808,-0.32801,0.071541,0.26277,-0.6131,-0.070354,0.1972,0.70892,0.58233,-0.63148,-0.20872,0.3956,0.67707,0.2264,-0.75216,0.49038,-0.6775,0.2472,-0.16565,-0.48447,-0.21045,0.22927,0.65942,0.32178,-0.12592,-0.38609,-0.61413,0.18992,-0.73068,0.49569,-0.44867,-0.059065,0.11962,-0.24218,0.34359,0.025997,0.33442,-0.016365,0.53136,-0.3645,-0.42449,-0.1735,0.97715,0.63282,-0.27106,0.36279,-0.78746,-0.21372,-0.0626,-0.017384,-0.73708,-0.14166,0.7353,0.78045,0.038346,-0.16281,0.62714,-0.08234,-0.99388,0.23097,-0.91484,0.35235,0.99686,0.778,-0.36333,-0.33055,0.67011,-0.16661,0.68815,0.83753,-0.27793,0.21578,0.76533,-0.85458,-0.30271,0.31338,0.3994,0.77155,-0.42731,-0.31665,-0.42918,0.1632,0.60957,-0.90909,-0.12902,-0.21022,-0.51385,-0.52553,0.0033594,0.81185,0.3156,0.99573,0.40887,0.80732,0.26427,-0.90752,0.5647,-0.93956,0.78307,-0.44127,-0.8361,-0.23166,-0.1276,0.91028,0.87438,-0.68226,-0.86518,0.58751,0.19118,-0.30984,0.10376,-0.27448,-0.59791,0.88449,-0.33982,-0.35598,0.71343,-0.7674,0.23662,-0.70276,-0.11298,-0.2526,-0.88079,0.78039,0.24589,0.42679,0.90836,-0.23235,-0.58849,-0.96464,0.14878,0.69019,-0.55047,-0.87235,0.53226,-0.47358,0.33515,-0.94539,0.72424,-0.7192,-0.45353,0.41626,0.61397,-0.47414,0.55815,-0.64232,-0.089573,0.83593,-0.64357,-0.19881,0.32556,-0.97778,0.075256,0.82057,-0.16118,-0.31823,-0.061079,0.38167,0.5447,0.30391,-0.25881,0.68225,-0.86806,0.52783,-0.94301,0.36537,0.2682,-0.37696,0.53538,0.24265,0.35289,-0.87154,0.14072,0.77003,-0.97276,-0.55475,-0.85213,0.1003,-0.9787,-0.36814,0.26043,0.9824,-0.70369,-0.4323,-0.81607,-0.92747,-0.83592,0.92179,0.52449,0.85081,-0.97484,-0.58168,0.66276,0.91305,0.9394,-0.31119,-0.49871,-0.23898,0.69371,0.39764,-0.18704,-0.53542,0.52599,0.5368,0.74328,0.85927,0.58884,-0.33596,0.0032341,-0.45833,0.1591,-0.31769,0.74616,-0.62392,0.065942,0.89091,-0.86282,0.56552,0.50199,0.37495,0.29058,0.5914,-0.34925,-0.848,0.67134,0.99585,0.91469,0.31129,-0.73069,0.26945,-0.50529,-0.75911,-0.21243,-0.84512,0.12146,-0.20153,-0.3258,-0.06765,0.18924,-0.6993,0.76651,-0.53131,-0.86254,-0.46643,0.25676,-0.995,0.92181,0.75647,-0.81049,-0.86248,0.18227,-0.34288,0.9404,-0.26044,-0.86345,0.56714,-0.74397,-0.23731,0.66519,0.37952,-0.43731,0.42954,0.72901,-0.90435,-0.7217,0.19369,-0.85725,0.67375,0.54395,0.71475,0.47543,0.26072,-0.9799,-0.58403,0.9417,0.61202,0.29888,0.43424,0.56581,-0.049395,-0.62042,0.022366,-0.42241,0.26309,0.20212,-0.72666,-0.37561,0.99159,0.051887,0.13756,0.51241,-0.63514,0.34725,0.3913,0.22163,0.47584,-0.4461,-0.89644,0.0056873,0.026853,-0.44181,-0.64665,0.017741,0.27192,-0.33991,-0.89464,	
0.11753,0.089957,0.58969,0.11715,0.22991,0.074557,0.043214,0.08562,0.5344,0.1523,0.51128,0.21552,0.42069,0.55402,0.10088,0.31881,0.2654,0.52298,0.27681,0.10167,0.22853,0.2025,0.5147,0.50679,0.033396,0.011899,0.041091,0.2436,0.14488,0.53934,0.083742,0.045957,0.20105,0.44322,0.22322,0.32357,0.049622,0.41892,0.38641,0.35086,0.17943,0.32077,0.29863,0.24874,0.13157,0.42593,0.5606,0.48577,0.35576,0.3309,-0.55756,0.52586,-0.61464,-0.6018,-0.79868,-0.040415,0.33636,0.5779,-0.36726,-0.21006,-0.47878,0.54944,0.021131,-0.49581,0.57286,-0.61595,-0.3655,-0.20658,-0.47239,-0.025066,-0.61437,-0.2454,-0.88639,-0.89797,-0.059455,-0.30841,0.37385,-0.49475,-0.47225,-0.86378,-0.50894,-0.39415,-0.32929,0.48641,-0.58837,0.28306,0.050515,-0.69838,-0.67448,-0.27097,-0.091694,-0.28483,-0.20213,0.54072,-0.47925,-0.73959,0.10575,0.2649,0.20909,0.035131,0.60661,-0.21805,0.18413,-0.28593,-0.53551,0.23647,-0.54116,0.76849,0.42435,-0.25371,0.63518,0.1539,-0.40217,-0.27364,0.93604,0.31669,-0.44385,0.21871,0.23658,0.56993,0.50608,0.16958,-0.89348,-0.83709,0.13166,0.1459,0.59892,0.29759,0.69275,0.81646,0.12894,0.64626,-0.30723,0.22107,0.32369,0.70992,0.84815,-0.79193,-0.93628,-0.035373,-0.60598,-0.91163,0.78517,0.89477,-0.58411,0.099186,-0.33356,0.15199,-0.00011169,-0.24085,0.32125,0.6369,-0.5247,0.84498,-0.33467,0.40354,-0.20067,-0.10132,-0.2386,-0.21868,0.85842,0.83555,-0.17069,-0.30636,0.30972,0.81962,-0.40629,-0.49996,0.31176,0.45275,-0.24693,0.52171,0.2185,0.010842,0.84077,-0.27045,0.58995,0.14093,-0.20652,-0.21275,-0.03824,0.61354,-0.27238,-0.18084,-0.38939,0.026731,0.26568,-0.3906,-0.398,0.26127,0.26204,0.47781,0.92935,0.21734,0.18581,0.052407,0.59047,0.89298,-0.32003,0.41692,-0.25631,-0.098573,-0.10855,-0.53066,-0.40363,-0.19653,-0.12368,-0.25233,-0.55292,-0.16222,-0.53198,-0.27475,-0.3816,-0.48852,-0.3825,-0.25632,-0.098306,-0.24238,-0.37257,-0.47762,-0.53216,-0.27734,-0.59332,-0.15591,-0.47232,-0.34101,-0.29419,-0.4124,-0.22879,-0.30459,-0.20983,-0.33022,-0.18169,-0.42175,-0.47168,-0.37434,-0.013482,-0.10077,-0.39194,-0.18796,-0.57233,-0.40101,-0.36697,-0.3373,-0.57499,-0.37634,-0.08374,-0.066608,-0.31557,-0.37521,0.69089,-0.33457,-0.45469,0.30372,0.27679,0.37853,-0.74402,0.50188,0.30009,0.64742,0.96757,-0.92245,0.77259,0.49687,0.14345,-0.96267,-0.017949,0.23947,-0.8435,0.93592,0.073982,0.50784,0.55428,0.28726,-0.56638,0.59079,-0.57517,0.22229,0.088647,0.36733,0.30269,-0.63834,0.60481,-0.93984,0.21644,-0.81526,0.09125,-0.77123,0.218,0.75636,-0.8745,-0.92258,0.20423,-0.35749,-0.76484,-0.97057,-0.52061,-0.34316,0.40617,0.52559,-0.51383,-0.84641,0.19928,-0.090932,0.42623,0.6141,0.14543,-0.2047,-0.30896,-0.19403,-0.37064,0.03722,0.42716,-0.65937,-0.2138,-0.50249,-0.31665,-0.95111,0.18924,-0.72941,0.59762,-0.84273,-0.49855,-0.44374,0.55163,0.046328,-0.070274,-0.97123,-0.49917,-0.047552,0.63835,0.42828,-0.89855,0.17168,0.57197,0.085843,-0.45489,-0.049426,0.98028,0.2114,-0.32802,-0.27246,0.43313,-0.82325,0.13402,-0.89002,-0.48585,0.92013,0.76934,0.22952,-0.033708,0.50458,-0.33099,-0.52359,-0.91186,0.56794,0.92968,0.74626,-0.98162,0.92445,0.88746,-0.092372,-0.34709,-0.10839,0.51204,0.61918,0.99486,0.83298,0.93196,-0.92454,-0.5938,-0.64236,0.22656,0.1072,0.6033,0.22706,-0.9304,-0.77404,-0.77438,-0.7399,0.19906,0.11974,-0.84409,-0.61602,0.5538,0.67083,0.86073,-0.36842,0.35293,-0.99248,0.1544,-0.90202,-0.3972,-0.67729,0.00090234,-0.28137,0.95527,0.22971,0.07328,0.22269,0.39194,0.20993,-0.045674,-0.1412,0.10925,-0.58738,-0.11022,0.42109,-0.64319,0.30294,0.65921,0.037191,-0.2304,-0.52605,-0.86021,0.73771,-0.28195,0.15339,0.82505,-0.82025,0.54769,-0.043898,0.096945,0.74923,-0.38851,0.31124,-0.17998,-0.26738,0.4339,0.66698,0.3459,0.82958,-0.069556,0.21223,-0.49799,-0.97074,-0.675,0.10346,-0.4994,-0.26632,-0.88979,0.27031,0.86579,0.50939,0.53975,-0.48798,0.71617,0.21408,0.20155,-0.49396,-0.27277,0.10636,-0.74952,0.10909,0.58318,-0.94628,0.11161,0.78371,0.24367,0.87831,0.11463,-0.84415,-0.71729,-0.16085,-0.63962,0.94591,0.65038,0.64147,-0.51154,0.85952,0.59889,0.51895,0.56096,-0.87721,0.43224,0.61252,0.036137,0.49273,-0.2691,0.064895,0.56035,0.74443,0.53083,0.038325,-0.45909,0.10722,-0.64058,-0.37041,0.0040789,-0.74171,-0.37197,-0.77811,0.075862,-0.32094,0.87955,-0.72518,0.30109,-0.96162,0.78553,-0.37438;

	t.SetSampler(TLinkage::UNIFORM);
	t.Sample(data, samples, 5 * data.cols());
//	cout << endl << endl << samples << endl << endl;
	t.GenerateHypothesis(data, samples, hypotheses);
//	cout << endl << endl << hypotheses << endl << endl;
	t.FindResiduals(data, hypotheses, residuals);
//	cout << endl << endl << residuals << endl << endl;
	t.FindPreferences(residuals, pref, TLinkage::EXP, 0.13);
//	cout << endl << endl << pref << endl << endl;
	t.Cluster(pref, clusters);
//	cout << endl << endl << clusters << endl << endl;
	t.RejectOutliers(clusters, clusters);
//	cout << clusters << endl;
	vector<ArrayXf> models;
	t.FitModels(data, clusters, models);
//	for(int i = 0; i < models.size(); i++)
//		cout << models[i] << endl << endl;
}
